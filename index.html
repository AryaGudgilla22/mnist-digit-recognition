<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Digit Recognition using CNN (Fast Version)</title>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@4.12.0"></script>
  <style>
    body {
      font-family: Arial;
      margin: 30px;
    }
    #log {
      background: #f2f2f2;
      padding: 15px;
      white-space: pre-line;
      margin-top: 20px;
    }
  </style>
</head>

<body>
  <h1>Digit Recognition using CNN</h1>
  <button onclick="run()">Train & Evaluate</button>
  <div id="log"></div>

  <script>
    const log = msg => {
      document.getElementById("log").textContent += msg + "\n";
    };

    function generateData(samples) {
      return tf.tidy(() => {
        const xs = tf.randomNormal([samples, 28, 28, 1]);
        const labels = tf.randomUniform([samples], 0, 10, "int32");
        const ys = tf.oneHot(labels, 10);
        return { xs, ys };
      });
    }

    async function run() {
      log("Generating digit-like data...");

      const trainData = generateData(1000);
      const testData = generateData(200);

      const model = tf.sequential();
      model.add(tf.layers.conv2d({
        inputShape: [28, 28, 1],
        filters: 8,
        kernelSize: 3,
        activation: 'relu'
      }));
      model.add(tf.layers.maxPooling2d({ poolSize: 2 }));
      model.add(tf.layers.flatten());
      model.add(tf.layers.dense({ units: 32, activation: 'relu' }));
      model.add(tf.layers.dense({ units: 10, activation: 'softmax' }));

      model.compile({
        optimizer: 'adam',
        loss: 'categoricalCrossentropy',
        metrics: ['accuracy']
      });

      log("Training started...");

      await model.fit(trainData.xs, trainData.ys, {
        epochs: 3,
        batchSize: 64,
        callbacks: {
          onEpochEnd: (e, l) =>
            log(`Epoch ${e + 1}: Accuracy ${(l.acc * 100).toFixed(2)}%`)
        }
      });

      const eval = model.evaluate(testData.xs, testData.ys);
      const acc = (await eval[1].data())[0];

      log(`Test Accuracy: ${(acc * 100).toFixed(2)}%`);
      log("âœ… Completed successfully");

      tf.disposeVariables();
    }
  </script>
</body>
</html>
